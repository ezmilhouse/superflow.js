var superflow=function(exports){var version='0.0.1';var root=this;var previous_superflow=root.superflow;function noConflict(){root.superflow=previous_superflow;return this;}function noop(){}function isFunction(mixed){return typeof(mixed)=='function';}function isArray(mixed){return mixed instanceof Array&&mixed.length>0;}function Flow(name,callback,par){this.last=null;this.idle=true;this.jobs=[];this.vars={};this.done=null;this.dead=false;this.name=null;if(par){this.par(name,callback);}else{this.seq(name,callback);}this.set=function(name,value){if(name)this.vars[name]=value;};this.get=function(name){if(name)return this.vars[name];};this.context=this;return this;}Flow.prototype.die=function(callback,value){var that=this;if(this.idle){this.jobs.push({name:'__die__',callback:function(){return that.die.call(that,callback);}});return this;}else{if(callback||callback===false){if(isFunction(callback)){this.dead=true;this.done=callback;}else{if(callback===true){this.dead=true;if(isFunction(value)){if(value.length){value(false);}else{this.done=value;}}}else{if(isFunction(value)){if(value.length){value(true);}else{this.done=value;}}else{return value||false;}}}}else{this.dead=true;}}};Flow.prototype.seq=function(name,callback){if(isFunction(name)){callback=name;name=null;}if(!callback)return this;this.last='seq';this.jobs.push({name:name,callback:callback});return this;};Flow.prototype.par=function(name,callback){if(isFunction(name)){callback=name;name=null;}if(!callback)return this;if(this.last==='par'){this.jobs[this.jobs.length-1].push({name:name,callback:callback});}else{this.jobs.push([{name:name,callback:callback}]);this.last='par';}return this;};Flow.prototype.next=function(arr){var that=this;var go=function(arr,callback){arr.shift();if(arr.length>0){if(!that.dead)return that.next(arr);if(callback)return callback();that.done.call(that.context,null,that.data);}else{if(callback)return callback();that.done.call(that.context,null,that.data);}};var io=function(arr,callback){if(arr[0].callback.length){arr[0].callback.call(that.context,function(err,data){if(arr[0].name==='__die__')return go(arr,callback);if(arr[0].name)that.set(arr[0].name,data||null);go(arr,callback);});}else{var data=arr[0].callback.call(that.context);if(arr[0].name==='__die__')return go(arr,callback);if(arr[0].name)that.set(arr[0].name,data||null);go(arr,callback);}};if(this.dead)return this.done.call(this.context,null,this.data);if(isArray(arr[0])){if(arr[0].length>0){var m=arr[0].length,c=0;for(var i=0;i<m;i++){io([arr[0][i]],function(){c+=1;if(c>=m){arr.shift();return that.next(arr);}});}}else{if(arr.length>0){io(arr);}else{this.done.call(this.context,null,this.data);}}}else{if(arr.length>0){io(arr);}else{this.done.call(this.context,null,this.data);}}};Flow.prototype.end=function(callback){this.idle=false;this.done=callback||noop;this.next(this.jobs);};function seq(name,callback){return new Flow(name,callback);}function par(name,callback){return new Flow(name,callback,true);}exports={version:version,seq:seq,par:par,noConflict:noConflict};return exports;}({});